# à¸„à¸¹à¹ˆà¸¡à¸·à¸­à¸£à¸°à¸šà¸š KPI Tracking

[TOC]

**à¹€à¸­à¸à¸ªà¸²à¸£à¸‰à¸šà¸±à¸šà¸™à¸µà¹‰:** à¸£à¸°à¸šà¸šà¸•à¸´à¸”à¸•à¸²à¸¡ KPI à¸ªà¸³à¸«à¸£à¸±à¸šà¸‡à¸šà¸›à¸£à¸°à¸¡à¸²à¸“
**à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸¡à¸·à¹ˆà¸­:** 2026-01-02
**à¸­à¸±à¸›à¹€à¸”à¸•à¸¥à¹ˆà¸²à¸ªà¸¸à¸”:** 2026-01-02 21:40 (UTC+7)
**Migration Files:**
- [`050_create_kpi_tables.sql`](file:///C:/laragon/www/hr_budget/database/migrations/050_create_kpi_tables.sql)
- [`051_kpi_triggers_constraints.sql`](file:///C:/laragon/www/hr_budget/database/migrations/051_kpi_triggers_constraints.sql)
**à¸ªà¸–à¸²à¸™à¸°:** âœ… **à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ (Production Ready)**

---

## ğŸ“‹ à¸ªà¸£à¸¸à¸›à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸šà¸£à¸´à¸«à¸²à¸£

à¸£à¸°à¸šà¸š KPI Tracking à¸£à¸­à¸‡à¸£à¸±à¸š:
- âœ… **6 à¹à¸«à¸¥à¹ˆà¸‡ KPI** (à¸à¸£à¸š, à¸à¸£à¸¡à¸šà¸±à¸à¸Šà¸µà¸à¸¥à¸²à¸‡, à¹à¸œà¸™à¸à¸£à¸°à¸—à¸£à¸§à¸‡, à¹à¸œà¸™à¸ªà¸³à¸™à¸±à¸à¸‡à¸²à¸™, à¸™à¹‚à¸¢à¸šà¸²à¸¢, à¸à¸³à¸«à¸™à¸”à¹€à¸­à¸‡)
- âœ… **5 à¸›à¸£à¸°à¹€à¸ à¸— Metric** (à¹€à¸šà¸´à¸à¸ˆà¹ˆà¸²à¸¢%, à¸ˆà¸³à¸™à¸§à¸™à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´, à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸², à¸ˆà¸³à¸™à¸§à¸™à¹‚à¸„à¸£à¸‡à¸à¸²à¸£, à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ)
- âœ… **4 à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸²** (Yearly, Quarterly, Monthly, Weekly)
- âœ… **Auto-calculation** à¸„à¸³à¸™à¸§à¸“ % à¸„à¸§à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸¥à¸°à¸ªà¸–à¸²à¸™à¸°à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´

---

## ğŸ”— ER Diagram

```mermaid
erDiagram
    KPI_SOURCES ||--o{ KPI_DEFINITIONS : "has"
    KPI_DEFINITIONS ||--o{ KPI_TARGETS : "has"
    KPI_TARGETS ||--o{ KPI_ACTUALS : "has"
    
    KPI_SOURCES {
        int id PK
        varchar code "ACT_FY, CGD, MIN_PLAN..."
        varchar name_th
        boolean is_system
    }
    
    KPI_DEFINITIONS {
        int id PK
        int kpi_source_id FK
        varchar code "DISB_PCT, APPROVAL_CNT..."
        enum metric_type "disbursement_pct, approval_count..."
        varchar unit "%, à¸šà¸²à¸—, à¸§à¸±à¸™, à¹‚à¸„à¸£à¸‡à¸à¸²à¸£"
    }
    
    KPI_TARGETS {
        int id PK
        int kpi_definition_id FK
        int fiscal_year "2569"
        enum period_type "yearly, quarterly, monthly, weekly"
        decimal target_value
        decimal threshold_warning
        decimal threshold_critical
    }
    
    KPI_ACTUALS {
        int id PK
        int kpi_target_id FK
        decimal actual_value
        decimal achievement_rate "Auto-calculated"
        enum status "achieved, warning, critical"
    }
```

---

## ğŸ“Š à¹à¸«à¸¥à¹ˆà¸‡ KPI (Sources)

| Code | à¸Šà¸·à¹ˆà¸­ | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|------|------|----------|
| `ACT_FY` | à¸à¸£à¸š à¸£à¸²à¸¢à¸ˆà¹ˆà¸²à¸¢à¸‡à¸šà¸›à¸£à¸°à¸¡à¸²à¸“à¸›à¸£à¸°à¸ˆà¸³à¸›à¸µ | KPI à¸•à¸²à¸¡ à¸à¸£à¸š. à¸‡à¸šà¸›à¸£à¸°à¸¡à¸²à¸“ |
| `CGD` | à¸à¸£à¸¡à¸šà¸±à¸à¸Šà¸µà¸à¸¥à¸²à¸‡ | KPI à¸ˆà¸²à¸à¸à¸£à¸¡à¸šà¸±à¸à¸Šà¸µà¸à¸¥à¸²à¸‡ |
| `MIN_PLAN` | à¹à¸œà¸™à¸à¸£à¸°à¸—à¸£à¸§à¸‡à¸¢à¸¸à¸•à¸´à¸˜à¸£à¸£à¸¡ | KPI à¸•à¸²à¸¡à¹à¸œà¸™à¸à¸£à¸°à¸—à¸£à¸§à¸‡ |
| `OPS_PLAN` | à¹à¸œà¸™à¸ªà¸³à¸™à¸±à¸à¸‡à¸²à¸™à¸›à¸¥à¸±à¸”à¸à¸£à¸°à¸—à¸£à¸§à¸‡ | KPI à¸£à¸°à¸”à¸±à¸šà¸ªà¸³à¸™à¸±à¸à¸‡à¸²à¸™ |
| `POLICY` | à¸™à¹‚à¸¢à¸šà¸²à¸¢/à¸‚à¹‰à¸­à¸ªà¸±à¹ˆà¸‡à¸à¸²à¸£ | KPI à¸ˆà¸²à¸à¸™à¹‚à¸¢à¸šà¸²à¸¢ |
| `CUSTOM` | à¸à¸³à¸«à¸™à¸”à¹€à¸­à¸‡ | KPI à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸à¸³à¸«à¸™à¸” |

---

## ğŸ“ˆ à¸›à¸£à¸°à¹€à¸ à¸— Metric

| Metric Type | à¸«à¸™à¹ˆà¸§à¸¢ | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|-------------|-------|----------|
| `disbursement_pct` | % | à¹€à¸›à¸­à¸£à¹Œà¹€à¸‹à¹‡à¸™à¸•à¹Œà¸à¸²à¸£à¹€à¸šà¸´à¸à¸ˆà¹ˆà¸²à¸¢ |
| `approval_count` | à¸£à¸²à¸¢à¸à¸²à¸£ | à¸ˆà¸³à¸™à¸§à¸™à¸à¸²à¸£à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´ |
| `processing_time` | à¸§à¸±à¸™ | à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£ |
| `project_count` | à¹‚à¸„à¸£à¸‡à¸à¸²à¸£ | à¸ˆà¸³à¸™à¸§à¸™à¹‚à¸„à¸£à¸‡à¸à¸²à¸£ |
| `activity_completed` | à¸à¸´à¸ˆà¸à¸£à¸£à¸¡ | à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸ªà¸£à¹‡à¸ˆ |

---

## â±ï¸ à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸² (Period Types)

| Period Type | period_value | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|-------------|--------------|----------|
| `yearly` | NULL | à¸£à¸²à¸¢à¸›à¸µ (à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸£à¸°à¸šà¸¸ period_value) |
| `quarterly` | 1-4 | à¸£à¸²à¸¢à¹„à¸•à¸£à¸¡à¸²à¸ª (Q1, Q2, Q3, Q4) |
| `monthly` | 1-12 | à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™ |
| `weekly` | 1-52 | à¸£à¸²à¸¢à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ (à¸•à¹‰à¸­à¸‡à¸¡à¸µ start/end date) |

---

## âš¡ Auto-Calculation (Triggers)

### à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
à¹€à¸¡à¸·à¹ˆà¸­à¸šà¸±à¸™à¸—à¸¶à¸ `actual_value` à¸£à¸°à¸šà¸šà¸ˆà¸°à¸„à¸³à¸™à¸§à¸“à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´:

```
1. achievement_rate = (actual_value / target_value) * 100
2. variance = actual_value - target_value
3. status = achieved | warning | critical | exceeded
```

### à¹€à¸à¸“à¸‘à¹Œà¸à¸³à¸«à¸™à¸”à¸ªà¸–à¸²à¸™à¸°
| à¸ªà¸–à¸²à¸™à¸° | à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚ |
|--------|----------|
| `exceeded` | achievement_rate > 100% |
| `achieved` | achievement_rate >= 100% à¸«à¸£à¸·à¸­ >= warning threshold |
| `warning` | achievement_rate >= critical threshold |
| `critical` | achievement_rate < critical threshold |

### Default Thresholds
- **Warning:** 90% à¸‚à¸­à¸‡ target
- **Critical:** 70% à¸‚à¸­à¸‡ target

---

## ğŸ›¡ï¸ Constraints & Validation

### 1. Period Value Validation
```sql
-- period_value à¸•à¹‰à¸­à¸‡à¸•à¸£à¸‡à¸à¸±à¸š period_type
period_type = 'yearly' â†’ period_value = NULL
period_type = 'quarterly' â†’ period_value = 1-4
period_type = 'monthly' â†’ period_value = 1-12
period_type = 'weekly' â†’ period_value = 1-52
```

### 2. Weekly Date Requirement
```sql
-- weekly à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸§à¸±à¸™à¸—à¸µà¹ˆ
period_type = 'weekly' â†’ period_start_date & period_end_date à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆ NULL
```

---

## ğŸ“ à¸§à¸´à¸˜à¸µà¹ƒà¸Šà¹‰à¸‡à¸²à¸™

### 1. à¸ªà¸£à¹‰à¸²à¸‡ Target
```sql
INSERT INTO kpi_targets 
(kpi_definition_id, fiscal_year, period_type, period_value, target_value, threshold_warning, threshold_critical)
VALUES 
(1, 2569, 'quarterly', 1, 25.00, 22.50, 17.50);  -- Q1 target 25%
```

### 2. à¸šà¸±à¸™à¸—à¸¶à¸à¸œà¸¥à¸ˆà¸£à¸´à¸‡ (Auto-calculate)
```sql
INSERT INTO kpi_actuals (kpi_target_id, actual_value, recorded_date)
VALUES (1, 23.50, '2569-12-31');

-- à¸£à¸°à¸šà¸šà¸„à¸³à¸™à¸§à¸“à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´:
-- achievement_rate = 94%
-- variance = -1.50
-- status = 'achieved' (à¹€à¸à¸£à¸²à¸° >= 90%)
```

### 3. Query Dashboard
```sql
SELECT * FROM v_kpi_dashboard 
WHERE fiscal_year = 2569 
  AND period_type = 'quarterly'
ORDER BY source_code, kpi_code;
```

---

## ğŸ” Dashboard View

à¸£à¸°à¸šà¸šà¸¡à¸µ View `v_kpi_dashboard` à¸ªà¸³à¸«à¸£à¸±à¸šà¹à¸ªà¸”à¸‡à¸œà¸¥à¸£à¸§à¸¡:

| Column | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|--------|----------|
| source_code, source_name | à¹à¸«à¸¥à¹ˆà¸‡ KPI |
| kpi_code, kpi_name | à¸Šà¸·à¹ˆà¸­ KPI |
| metric_type, unit | à¸›à¸£à¸°à¹€à¸ à¸—à¹à¸¥à¸°à¸«à¸™à¹ˆà¸§à¸¢ |
| fiscal_year, period_type, period_value | à¸Šà¹ˆà¸§à¸‡à¹€à¸§à¸¥à¸² |
| target_value | à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢ |
| actual_value | à¸œà¸¥à¸ˆà¸£à¸´à¸‡ |
| achievement_rate | % à¸„à¸§à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ |
| status | à¸ªà¸–à¸²à¸™à¸° |
| color_good, color_warning, color_bad | à¸ªà¸µà¹à¸ªà¸”à¸‡à¸œà¸¥ |

---

## â“ FAQ

| à¸„à¸³à¸–à¸²à¸¡ | à¸„à¸³à¸•à¸­à¸š |
|-------|-------|
| KPI à¸„à¸³à¸™à¸§à¸“à¹€à¸­à¸‡à¹„à¸«à¸¡? | âœ… à¹ƒà¸Šà¹ˆ, Trigger à¸„à¸³à¸™à¸§à¸“ % à¹à¸¥à¸°à¸ªà¸–à¸²à¸™à¸°à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´ |
| à¹€à¸à¸´à¹ˆà¸¡ KPI à¹ƒà¸«à¸¡à¹ˆà¹„à¸”à¹‰à¹„à¸«à¸¡? | âœ… à¹„à¸”à¹‰, à¹€à¸à¸´à¹ˆà¸¡à¹ƒà¸™ `kpi_definitions` |
| à¸¥à¸š Source à¹„à¸”à¹‰à¹„à¸«à¸¡? | âŒ à¸–à¹‰à¸² `is_system = 1` à¹„à¸¡à¹ˆà¸„à¸§à¸£à¸¥à¸š |
| à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ Threshold à¹„à¸”à¹‰à¹„à¸«à¸¡? | âœ… à¹„à¸”à¹‰, à¹à¸à¹‰à¹ƒà¸™ `kpi_targets` |
| à¸£à¸­à¸‡à¸£à¸±à¸š Weekly à¹„à¸«à¸¡? | âœ… à¸£à¸­à¸‡à¸£à¸±à¸š, à¸•à¹‰à¸­à¸‡à¸£à¸°à¸šà¸¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡-à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸” |

---

## ğŸ“š Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2026-01-01 | Initial KPI tables (050) |
| 1.1 | 2026-01-01 | Added triggers & constraints (051) |
| 1.2 | 2026-01-02 | Documentation created |

---

## ğŸš€ Roadmap

| Phase | à¸ªà¸–à¸²à¸™à¸° | à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” |
|-------|-------|-------------|
| **Phase 1: Database** | âœ… | Tables, Triggers, Constraints |
| **Phase 2: Seed Data** | âœ… | 6 Sources, 5 Definitions |
| **Phase 3: Admin UI** | ğŸ“‹ | Manage KPI definitions & targets |
| **Phase 4: Dashboard** | ğŸ“‹ | Visual KPI cards & charts |
| **Phase 5: Reports** | ğŸ“‹ | Export & PDF reports |

---

## ğŸ“ à¸ªà¸£à¸¸à¸›

- âœ… **4 à¸•à¸²à¸£à¸²à¸‡:** Sources â†’ Definitions â†’ Targets â†’ Actuals
- âœ… **1 View:** `v_kpi_dashboard` à¸ªà¸³à¸«à¸£à¸±à¸š Query
- âœ… **2 Triggers:** Auto-calculate achievement & status
- âœ… **2 Functions:** `calculate_achievement_rate()`, `determine_kpi_status()`
- âœ… **2 Constraints:** Period validation, Weekly dates

**Migration Files:**
- [`050_create_kpi_tables.sql`](file:///C:/laragon/www/hr_budget/database/migrations/050_create_kpi_tables.sql)
- [`051_kpi_triggers_constraints.sql`](file:///C:/laragon/www/hr_budget/database/migrations/051_kpi_triggers_constraints.sql)

---

**à¸ˆà¸±à¸”à¸—à¸³à¹€à¸¡à¸·à¹ˆà¸­:** 2026-01-02 21:40 (UTC+7)
**à¸œà¸¹à¹‰à¸ˆà¸±à¸”à¸—à¸³:** Antigravity AI Assistant
