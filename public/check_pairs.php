<?php
// public/check_pairs.php
error_reporting(E_ALL);
require_once __DIR__ . '/../vendor/autoload.php';
$dotenv = Dotenv\Dotenv::createImmutable(__DIR__ . '/../');
$dotenv->safeLoad();
require_once __DIR__ . '/../src/Core/Database.php';
use App\Core\Database;

header('Content-Type: application/json');

$pairs = [
    ["เงินเดือน", "เงินเดือนและค่าตอบแทนประจำ"],
    ["เงินหรือที่เรียกเป็นอย่างอื่น", "อัตราเงินเดือนและค่าจ้าง"],
    ["อัตราเดิม", "อัตราเงินเดือนเดิม"],
    ["อัตราใหม่", "อัตราเงินเดือนใหม่"],
    ["เงินอื่นที่จ่ายควบกับเงินเดือน", "เงินเพิ่ม ค่าตอบแทนพิเศษอื่นๆ"],
    ["เงินประจำตำแหน่ง รวม", "เงินประจำตำแหน่งทุกประเภท"],
    ["ค่าตอบแทนเท่ากับเงินประจำตำแหน่ง", "ค่าตอบแทนตำแหน่งต่างๆ"],
    ["เงินช่วยเหลือการครองชีพข้าราชการระดับต้น", "เงินช่วยเหลือการครองชีพ"],
    ["เงิน พ.ต.ก.", "เงินเพิ่มตำแหน่งที่มีเหตุพิเศษของขรก.พลเรือน (ผู้ปฏิบัติงานด้านนิติกร)"],
    ["เงิน พ.พ.ด.", "เงินเพิ่มพิเศษสำหรับผู้ปฏิบัติงานด้านพัสดุ"],
    ["เงิน พ.ส.ร.", "เงินเพิ่มพิเศษสำหรับการสู้รบ"],
    ["เงิน สปพ.", "เงินสวัสดิการสำหรับการปฏิบัติงานประจำสำนักงานในพื้นที่พิเศษ"],
    ["ค่าจ้างประจำ", "ค่าจ้างประจำและค่าตอบแทนอื่นๆ"],
    ["ค่าตอบแทนพิเศษเงินเดือนเต็มขั้น", "ค่าตอบแทนพิเศษเงินเดือนเต็มขั้น"],
    ["ค่าตอบแทนพิเศษรายเดือนให้แก่เจ้าหน้าที่ผู้ปฏิบัติงานในพื้นที่จังหวัดชายแดนภาคใต้", "ค่าตอบแทนพิเศษสำหรับจังหวัดชายแดนภาคใต้"],
    ["ค่าใช้จ่าย", "ค่าใช้จ่ายต่างๆ"],
    ["เงินสมทบกองทุนประกันสังคม", "เงินสมทบกองทุนประกันสังคม"],
    ["เงินสมทบกองทุนเงินทดแทน", "เงินสมทบกองทุนเงินทดแทน"]
];

$results = [];

try {
    foreach ($pairs as $pair) {
        $name1 = $pair[0];
        $name2 = $pair[1];
        
        // Fuzzy search for Name 1
        $term1 = '%' . $name1 . '%';
        $term2 = '%' . $name2 . '%';
        
        $sql = "SELECT id, item_name, is_active FROM budget_category_items WHERE item_name LIKE ? OR item_name LIKE ?";
        $rows = Database::query($sql, [$term1, $term2]);
        
        $results[] = [
            'pair' => $pair,
            'matches' => $rows
        ];
    }
    
    echo json_encode(['success' => true, 'data' => $results], JSON_PRETTY_PRINT | JSON_UNESCAPED_UNICODE);
} catch (Exception $e) {
    echo json_encode(['success' => false, 'error' => $e->getMessage()]);
}
